package com.smarteinc.api.tests;

import static com.jayway.restassured.RestAssured.given;

import java.io.IOException;
import java.io.InputStream;
import java.util.HashMap;
import java.util.Map;
import java.util.Properties;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.apache.poi.xssf.usermodel.XSSFSheet;
import org.testng.annotations.BeforeTest;

import com.google.gson.JsonObject;
import com.jayway.restassured.RestAssured;
import com.jayway.restassured.response.Response;
import com.smarteinc.objects.PEApiInputObjects;
import com.smarteinc.objects.PIPLInputObjects;
import com.smarteinc.peapi.PEAPI_Library;
import com.smarteinc.utility.APIUtility;
import com.smarteinc.utility.ExcelUtility;

public class DirectDialTest {
		
	Properties prop = new Properties();		
	PEApiInputObjects obj;
	
	private static Logger logger = initializeLogger(new MatchBackTest());

	public static Logger initializeLogger(Object classObject) {
		System.setProperty("logDirectory", "..\\com.smarteinc.automation\\logs");
		logger = LogManager.getLogger(classObject.getClass().getSimpleName());
		return logger;
	}

	@BeforeTest
	public void beforeTest() throws IOException, IOException {
	    obj = new PEApiInputObjects();
		String propFileName = "/Config/Tranalyzer.properties";
		
		InputStream inputStream = MatchBackTest.class.getResourceAsStream(propFileName);

		if (inputStream != null) {
			try {
				prop.load(inputStream);
			} catch (IOException e) {

			}
		}		
	}
	
	
	public void DirectdialTest()
	{
		Response res = null;
		XSSFSheet sheet = null;
	    String file = MatchBackTest.class.getResource("/TestData/DirectDial/directdial.xlsx").getPath();
		
		try {

			String URL = "https://34.68.215.208:8243/dial/1/fetch";
			sheet = ExcelUtility.openSpreadSheet(file, "direct");
			int lastRow = sheet.getLastRowNum();

			Map<String, String> hm = new HashMap<String, String>();
			PEAPI_Library tran = new PEAPI_Library();

			PIPLInputObjects obj = new PIPLInputObjects();

			for (int row = 1; row <= lastRow; row++) {
				// Input fields

				System.out.println("row" + row);
				String fName = ExcelUtility.getCellData(sheet, row, "FirstName");
				String lName = ExcelUtility.getCellData(sheet, row, "LastName");
				String mName = ExcelUtility.getCellData(sheet, row, "MiddleName");
				String email = ExcelUtility.getCellData(sheet, row, "Email");

				RestAssured.baseURI = "https://api.pipl.com/search/";
				res = given().queryParam("email", email).queryParam("key", "1j0xqe9xthat6iefdjq0nai2")
						.queryParam("first_name", fName).queryParam("last_name", lName).queryParam("middle_name", mName)
						.queryParam("top_match", "true").contentType("application/x-www-form-urlencoded").when().get();

				JsonObject personObject = APIUtility.getMemberValue(res, "person").getAsJsonObject();

			}
	     }
		catch(Exception ex)
		{
			
		}
		

}
